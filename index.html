<!DOCTYPE html>
<html>

<head>
    <style>
        a:link {
            color: #10a8f0
        }
    </style>
</head>

<body style="background-color:#313338" text="dddddd">
    <p style="font-family:Beleren; font-size:32px; margin-bottom:0"><b>Magic The Gathering: decklist word
            cloud</b></p>
    <canvas id="my_Canvas" width="1px" height="1px"></canvas>

    <!--szukajka-->
    <p style="font-family:Arial">
        
        IMPORTANT - DECKLIST FORMAT:<br>
        1 CARD1<br>
        1 CARD2<br>
        etc.<br><br>
        Import a decklist:
        <br>
        <textarea id="decklistField" value="" style="font-family: Arial; color: #dddddd; height:100px; width:500px; background-color:#2e3035"></textarea>
        <br>
        <button type="button" onclick="importDecklist()">Import decklist</button>
        <button type="button" onclick="clearDecklist()">Clear decklist</button>
        <button type="button" onclick="clearOracle()">Clear oracle</button>
        <button type="button" onclick="createWordcloud()">Create wordcloud</button><br>

        Combined, filtered oracle text for word cloud:
        <br>

        <textarea id="searchResultField" value="" style="font-family: Arial; color: #dddddd; height:200px; width:370px; background-color:#2e3035"></textarea>
        <textarea id="searchResultFieldName" value="" style="font-family: Arial; color: #dddddd; height:200px; width:120px; background-color:#2e3035"></textarea>
    </p>

    <script defer src="./wordcloud/src/wordcloud2.js"></script>

    <script>

        //search for a card and display it in the textarea below



        let apiCardName = "";
        let apiCardURL = "";
        let oracleBubble = "";
        let apiCardNames = "";
        let decklistRaw = "";

        function clearDecklist() {
            let clearDecklistText = "";
            clearDecklistText = document.getElementById("decklistField");
            clearDecklistText.value = "";
        }

        function clearOracle() {
            let clearOracle = "";
            clearOracle = document.getElementById("searchResultField");
            clearOracle.value = "";
            let clearOracle2 = "";
            clearOracle2 = document.getElementById("searchResultFieldName");
            clearOracle2.value = "";
        }

        function createWordcloud() {
            console.log(oracleBubble)
            const outputArray = words2weight(oracleBubble)
            const canvas = document.getElementById('my_Canvas')
            canvas.width = 800
            canvas.height = 480

            WordCloud(document.getElementById('my_Canvas'), { list: outputArray, color: 'random-light', fontFamily: 'Couture', backgroundColor: '#313338', minRotation: 0, maxRotation: 0, weightFactor: 2 });
            oracleBubble = ""
        }

        const words2weight = (str) => {
            const returnMap = new Map();
            const words = str.split(' ')
            words.forEach(word => {
                if (returnMap.has(word)) {
                    returnMap.set(word, returnMap.get(word) + 1)
                }
                else {
                    returnMap.set(word, 1)
                }

            });

            //array^2
            console.log(Array.from(returnMap.entries()))
            //Array.from(returnMap.entries())
            return Array.from(returnMap.entries())
            //wytwalic wartosci 1
        }


        const importDecklist = async () => {
            let decklistRaw = "";
            decklistRaw = document.getElementById("decklistField").value;
            decklistRaw = decklistRaw.slice(2);
            decklistRaw = decklistRaw.replace(/(\r\n..|\n..|\r..)/gm, "\n")

            decklistArray = decklistRaw;
            decklistArray = decklistArray.split("\n");
            console.log(decklistArray);
            console.log(decklistArray.length);

            for (let index = 0; index < decklistArray.length; index++) {

                let importCardName = "";
                importCardName = decklistArray[index];
                importCardURL = 'https://api.scryfall.com/cards/search?q=' + importCardName;

                const response = await fetch(importCardURL);
                const json = await response.json();
                const cardData = json.data[0];
                const cardName = cardData.name;
                const cardOracle = cardData.oracle_text;

                let result = document.getElementById("searchResultField");
                let names = document.getElementById("searchResultFieldName");

                oracleBubble = oracleBubble + cardOracle + " ";
                //filtering characters
                oracleBubble = oracleBubble.replace(/(\n)/gm, " ")
                oracleBubble = oracleBubble.replace(/({.})/gm, "")
                oracleBubble = oracleBubble.replace(/(,)/gm, "")
                oracleBubble = oracleBubble.replace(/(\.)/gm, "")
                oracleBubble = oracleBubble.replace(/(:)/gm, "")
                oracleBubble = oracleBubble.replace(/(")/gm, "")
                oracleBubble = oracleBubble.replace(/[()]/gm, "")
                oracleBubble = oracleBubble.toLowerCase()
                //filtering words
                oracleBubble = oracleBubble.replace(/( a )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 1 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 2 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 3 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 4 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 5 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 6 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 7 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 8 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 9 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( an )/gm, " ")
                oracleBubble = oracleBubble.replace(/( of )/gm, " ")
                oracleBubble = oracleBubble.replace(/( on )/gm, " ")
                oracleBubble = oracleBubble.replace(/( its )/gm, " ")
                oracleBubble = oracleBubble.replace(/( it )/gm, " ")
                oracleBubble = oracleBubble.replace(/( one )/gm, " ")
                oracleBubble = oracleBubble.replace(/( two )/gm, " ")
                oracleBubble = oracleBubble.replace(/( three )/gm, " ")
                oracleBubble = oracleBubble.replace(/( put )/gm, " ")
                oracleBubble = oracleBubble.replace(/( add )/gm, " ")
                oracleBubble = oracleBubble.replace(/( may )/gm, " ")
                oracleBubble = oracleBubble.replace(/( cards )/gm, " ")
                oracleBubble = oracleBubble.replace(/( card )/gm, " ")
                oracleBubble = oracleBubble.replace(/( targets )/gm, " ")
                oracleBubble = oracleBubble.replace(/( target )/gm, " ")
                oracleBubble = oracleBubble.replace(/( controller )/gm, " ")
                oracleBubble = oracleBubble.replace(/( control )/gm, " ")
                oracleBubble = oracleBubble.replace(/( or )/gm, " ")
                oracleBubble = oracleBubble.replace(/( your )/gm, " ")
                oracleBubble = oracleBubble.replace(/( you )/gm, " ")
                oracleBubble = oracleBubble.replace(/( the )/gm, " ")
                oracleBubble = oracleBubble.replace(/( this )/gm, " ")
                oracleBubble = oracleBubble.replace(/( that )/gm, " ")
                oracleBubble = oracleBubble.replace(/( if )/gm, " ")
                oracleBubble = oracleBubble.replace(/( is )/gm, " ")
                oracleBubble = oracleBubble.replace(/( are )/gm, " ")
                oracleBubble = oracleBubble.replace(/( as )/gm, " ")
                oracleBubble = oracleBubble.replace(/( to )/gm, " ")
                oracleBubble = oracleBubble.replace(/( in )/gm, " ")
                oracleBubble = oracleBubble.replace(/( can )/gm, " ")
                oracleBubble = oracleBubble.replace(/( can't )/gm, " ")
                oracleBubble = oracleBubble.replace(/( has )/gm, " ")
                oracleBubble = oracleBubble.replace(/( any )/gm, " ")
                oracleBubble = oracleBubble.replace(/( with )/gm, " ")
                oracleBubble = oracleBubble.replace(/( without )/gm, " ")
            
                result.value = oracleBubble;
                apiCardNames = apiCardNames + cardName + "\n";
                names.value = apiCardNames;

            }
            console.log(oracleBubble);

        }


    </script>
    <p style="font-family:arial;">
    <i>2023 Fisz-git v. 1.0.3</i><br>
    <i>Card data obtained courtesy of Scryfall API <a href="https://scryfall.com/docs/api">https://scryfall.com/docs/api</a></i><br>
    <i>Word cloud generated using wordcloud2.js <a href="https://github.com/timdream/wordcloud2.js">https://github.com/timdream/wordcloud2.jst</a></i>
    </p>
</body>

</html>