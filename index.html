<!DOCTYPE html>
<html>

<head>
    <style>
        a:link {
            color: #10a8f0
        }

        @font-face {
            font-family: Beleren;
            src: url(beleren-bold_P1.01.ttf);
        }

        @font-face {
            font-family: Couture;
            src: url(couture-bld.otf);
        }
    </style>
</head>

<body style="background-color:#313338" text="dddddd">

    <p style="font-family:Beleren; font-size:32px; margin-bottom:0"><b>Magic The Gathering: decklist word
            cloud</b></p>
    <canvas id="my_Canvas" width="1px" height="1px"></canvas>

    <!--szukajka-->
    <p style="font-family:Arial">

        <b>IMPORTANT - DECKLIST FORMAT:</b><br>
        1 CARD1<br>
        1 CARD2<br>
        etc.<br>
        <b>NO SIDEBOARD, MAYBEBOARD HEADERS</b>
        <br><br>
        Import a decklist:
        <br>
        <textarea id="decklistField" value=""
            style="font-family: Arial; color: #dddddd; height:100px; width:500px; background-color:#2e3035"></textarea>
        <br>

        <button type="button" onclick="importDecklist()">Import decklist</button>
        <button type="button" onclick="clearDecklist()">Clear decklist</button>
        <button type="button" onclick="clearOracle()">Clear oracle</button>
        <button type="button" onclick="createWordcloud()">Create wordcloud</button><br>
        <br>

        Combined, filtered oracle text for word cloud:
        <br>

        <textarea id="searchResultField" value=""
            style="font-family: Arial; color: #dddddd; height:200px; width:370px; background-color:#2e3035"></textarea>
        <textarea id="searchResultFieldName" value=""
            style="font-family: Arial; color: #dddddd; height:200px; width:120px; background-color:#2e3035"></textarea>
    </p>

    <script defer src="./wordcloud/src/wordcloud2.js"></script>

    <script>

        //search for a card and display it in the textarea below



        let apiCardName = "";
        let apiCardURL = "";
        let oracleBubble = "";
        let colors = "";
        let costsString = "";
        let apiCardNames = "";
        let decklistRaw = "";
        let color1 = "#FFFFFF";
        let color2 = "#FFFFFF";
        let color3 = "#FFFFFF";
        let color4 = "#FFFFFF";
        let color5 = "#FFFFFF";

        function clearDecklist() {
            let clearDecklistText = "";
            clearDecklistText = document.getElementById("decklistField");
            clearDecklistText.value = "";
            color1 = ""
            color2 = ""
            oracleBubble = ""

        }

        function clearOracle() {
            let clearOracle = "";
            clearOracle = document.getElementById("searchResultField");
            clearOracle.value = "";
            let clearOracle2 = "";
            clearOracle2 = document.getElementById("searchResultFieldName");
            clearOracle2.value = "";
            oracleBubble = ""
        }

        function createWordcloud() {
            console.log(oracleBubble)
            const outputArray = words2weight(oracleBubble)
            const canvas = document.getElementById('my_Canvas')
            canvas.width = 800
            canvas.height = 480

            WordCloud(document.getElementById('my_Canvas'), {
                list: outputArray,
                color: function () {
                    return ([color1, color2, color3])[Math.floor(Math.random() * 3)]
                },
                fontFamily: 'Couture',
                backgroundColor: '#313338',
                minRotation: 0,
                maxRotation: 0,
                weightFactor: 2,
                shuffle: true
            });
        }

        const words2weight = (str) => {
            const returnMap = new Map();
            const words = str.split(' ')
            words.forEach(word => {
                if (returnMap.has(word)) {
                    returnMap.set(word, returnMap.get(word) + 1)
                }
                else {
                    returnMap.set(word, 1)
                }

            });

            //array^2
            console.log(Array.from(returnMap.entries()))
            //Array.from(returnMap.entries())
            return Array.from(returnMap.entries())
            //wytwalic wartosci 1
        }

        const importDecklist = async () => {
            let colors = "";
            let costsString = "";
            let decklistRaw = "";
            let decklistArray = [];
            let apiCardNames = "";
            decklistRaw = document.getElementById("decklistField").value;
            decklistRaw = decklistRaw.slice(2);
            decklistRaw = decklistRaw.replace(/(\r\n..|\n..|\r..)/gm, "\n")

            decklistArray = decklistRaw;
            decklistArray = decklistArray.split("\n");

            for (let index = 0; index < decklistArray.length; index++) {

                let importCardName = "";
                importCardName = decklistArray[index];
                importCardURL = 'https://api.scryfall.com/cards/named?exact=' + importCardName;

                const response = await fetch(importCardURL);
                //const json = await response.json();
                //const cardData = json.data[0];
                const cardData = await response.json();
                const cardName = cardData.name;
                const cardCost = cardData.color_identity;
                const cardOracle = cardData.oracle_text;

                let result = document.getElementById("searchResultField");
                let names = document.getElementById("searchResultFieldName");

                oracleBubble = oracleBubble + cardOracle + " ";
                costsString = costsString + cardCost;

                //filtering characters
                oracleBubble = oracleBubble.replace(/(\n)/gm, " ")
                oracleBubble = oracleBubble.replace(/({.})/gm, "")
                oracleBubble = oracleBubble.replace(/(,)/gm, "")
                oracleBubble = oracleBubble.replace(/(\.)/gm, "")
                oracleBubble = oracleBubble.replace(/(:)/gm, "")
                oracleBubble = oracleBubble.replace(/(")/gm, "")
                oracleBubble = oracleBubble.replace(/[()]/gm, "")
                oracleBubble = oracleBubble.toLowerCase()
                //filtering words
                oracleBubble = oracleBubble.replace(/( a )/gm, " ")
                oracleBubble = oracleBubble.replace(/( at )/gm, " ")
                oracleBubble = oracleBubble.replace(/( and )/gm, " ")
                oracleBubble = oracleBubble.replace(/( then )/gm, " ")
                oracleBubble = oracleBubble.replace(/( only )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 1 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 2 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 3 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 4 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 5 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 6 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 7 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 8 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( 9 )/gm, " ")
                oracleBubble = oracleBubble.replace(/( an )/gm, " ")
                oracleBubble = oracleBubble.replace(/( of )/gm, " ")
                oracleBubble = oracleBubble.replace(/( on )/gm, " ")
                oracleBubble = oracleBubble.replace(/( its )/gm, " ")
                oracleBubble = oracleBubble.replace(/( it )/gm, " ")
                oracleBubble = oracleBubble.replace(/( one )/gm, " ")
                oracleBubble = oracleBubble.replace(/( two )/gm, " ")
                oracleBubble = oracleBubble.replace(/( three )/gm, " ")
                oracleBubble = oracleBubble.replace(/( put )/gm, " ")
                oracleBubble = oracleBubble.replace(/( add )/gm, " ")
                oracleBubble = oracleBubble.replace(/( may )/gm, " ")
                oracleBubble = oracleBubble.replace(/( cards )/gm, " ")
                oracleBubble = oracleBubble.replace(/( card )/gm, " ")
                oracleBubble = oracleBubble.replace(/( targets )/gm, " ")
                oracleBubble = oracleBubble.replace(/( target )/gm, " ")
                oracleBubble = oracleBubble.replace(/( controller )/gm, " ")
                oracleBubble = oracleBubble.replace(/( control )/gm, " ")
                oracleBubble = oracleBubble.replace(/( or )/gm, " ")
                oracleBubble = oracleBubble.replace(/( your )/gm, " ")
                oracleBubble = oracleBubble.replace(/( you )/gm, " ")
                oracleBubble = oracleBubble.replace(/( the )/gm, " ")
                oracleBubble = oracleBubble.replace(/( this )/gm, " ")
                oracleBubble = oracleBubble.replace(/( that )/gm, " ")
                oracleBubble = oracleBubble.replace(/( if )/gm, " ")
                oracleBubble = oracleBubble.replace(/( is )/gm, " ")
                oracleBubble = oracleBubble.replace(/( are )/gm, " ")
                oracleBubble = oracleBubble.replace(/( as )/gm, " ")
                oracleBubble = oracleBubble.replace(/( to )/gm, " ")
                oracleBubble = oracleBubble.replace(/( in )/gm, " ")
                oracleBubble = oracleBubble.replace(/( can )/gm, " ")
                oracleBubble = oracleBubble.replace(/( can't )/gm, " ")
                oracleBubble = oracleBubble.replace(/( has )/gm, " ")
                oracleBubble = oracleBubble.replace(/( any )/gm, " ")
                oracleBubble = oracleBubble.replace(/( with )/gm, " ")
                oracleBubble = oracleBubble.replace(/( without )/gm, " ")

                result.value = oracleBubble;
                apiCardNames = apiCardNames + cardName + "\n";
                names.value = apiCardNames;
            }
            console.log(costsString);

            if (costsString.includes("W")) {
                colors = colors + "W";
            }
            if (costsString.includes("U")) {
                colors = colors + "U";
            }
            if (costsString.includes("B")) {
                colors = colors + "B";
            }
            if (costsString.includes("R")) {
                colors = colors + "R";
            }
            if (costsString.includes("G")) {
                colors = colors + "G";
            }
            if (colors === "") {
                colors = colors + "C"
            }

            if (colors === 'C') {
                color1 = "#6c6c6c"
                color2 = "#b2b2b2"
                color3 = "#8a8a8a"
            } else if (colors === 'W') {
                color1 = "#d1b264"
                color2 = "#d1c5a7"
                color3 = "#d3bd88"
            } else if (colors === 'U') {
                color1 = "#0064d1"
                color2 = "#107bf0"
                color3 = "#10a8f0"
            } else if (colors === 'B') {
                color1 = "#7700be"
                color2 = "#b373d9"
                color3 = "#9948ca"
            } else if (colors === 'R') {
                color1 = "#c80000"
                color2 = "#ca3e3e"
                color3 = "#cb6a6a"
            } else if (colors === 'G') {
                color1 = "#00551e"
                color2 = "#246b3d"
                color3 = "#367f50"
            } else if (colors === 'WU') {
                color1 = "#e9e0ca"
                color2 = "#107bf0"
                color3 = "#70cffc"
            } else if (colors === 'UB') {
                color1 = "#07357f"
                color2 = "#6c6c6c"
                color3 = "#00131c"
            } else if (colors === "BR") {
                color1 = "#6c6c6c"
                color2 = "#c80000"
                color3 = "#1c0000"
            } else if (colors === "RG") {
                color1 = "#c80000"
                color2 = "#246b3d"
                color3 = "#fa652f"
            } else if (colors === "WG") {
                color1 = "#f0fffb"
                color2 = "#367f50"
                color3 = "#ceffc1"
            } else if (colors === "WB") {
                color1 = "#fff0fc"
                color2 = "#9948ca"
                color3 = "#120022"
            } else if (colors === "UR") {
                color1 = "#ca3e3e"
                color2 = "#107bf0"
                color3 = "#cb6a6a"
            } else if (colors === "BG") {
                color1 = "#00551e"
                color2 = "#6c6c6c"
                color3 = "#000a03"
            } else if (colors === "WR") {
                color1 = "#c80000"
                color2 = "#d3bd88"
                color3 = "#fff7cc"
            } else if (colors === "UG") {
                color1 = "#367f50"
                color2 = "#10a8f0"
                color3 = "#00b98a"
            } else if (colors === "WBG") {
                color1 = "#ffebb5"
                color2 = "#171717"
                color3 = "#005e29"
            } else if (colors === "WUR") {
                color1 = "#fffeed"
                color2 = "#24afff"
                color3 = "#ff4000"
            } else if (colors === "UBG") {
                color1 = "#0d0d0d"
                color2 = "#006600"
                color3 = "#003c66"
            } else if (colors === "WBR") {
                color1 = "#c93c00"
                color2 = "#1f0900"
                color3 = "#fff7cf"
            } else if (colors === "URG") {
                color1 = "#e04000"
                color2 = "#10a8f0"
                color3 = "#00b98a"
            } else if (colors === "WUG") {
                color1 = "#fff9e8"
                color2 = "#3dcfff"
                color3 = "#1d8500"
            } else if (colors === "WUB") {
                color1 = "#003d82"
                color2 = "#051a33"
                color3 = "#d9eaff"
            } else if (colors === "UBR") {
                color1 = "#0467c4"
                color2 = "#1f0400"
                color3 = "#7d1000"
            } else if (colors === "BRG") {
                color1 = "#0b1700"
                color2 = "#d63d00"
                color3 = "#009600"
            } else if (colors === "WRG") {
                color1 = "#fff799"
                color2 = "#f24500"
                color3 = "#256e00"
            } else {
                console.log('Waiting for decklist');
            }
            console.log(colors);
            console.log(color1);
        }



    </script>
    <p style="font-family:arial;">
        <i>2023 Fisz-git v. 1.2.1</i><br>
        <i>Card data obtained courtesy of Scryfall API <a
                href="https://scryfall.com/docs/api">https://scryfall.com/docs/api</a></i><br>
        <i>Word cloud generated using wordcloud2.js <a
                href="https://github.com/timdream/wordcloud2.js">https://github.com/timdream/wordcloud2.jst</a></i>
    </p>
</body>

</html>